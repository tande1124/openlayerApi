{"version":3,"sources":["webpack:///./icon-sprite-webgl.js"],"names":["map","layers","source","attributions","url","tileSize","target","document","getElementById","view","center","zoom","vectorSource","features","style","variables","filterShape","filter","symbol","symbolType","src","size","color","rotateWithView","offset","textureCoord","shapeTypes","all","shapeSelect","addEventListener","options","selectedIndex","value","render","const","client","XMLHttpRequest","open","onload","curIndex","csv","responseText","prevIndex","indexOf","line","substr","split","coords","parseFloat","isNaN","shape","push","datetime","year","parseInt","exec","duration","geometry","addFeatures","Object","keys","sort","a","b","forEach","option","createElement","text","appendChild","send","addLayer","info","on","evt","getView","getInteracting","getAnimating","pixel","innerText","forEachFeatureAtPixel","feature","get"],"mappings":"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","file":"icon-sprite-webgl.js","sourcesContent":["import Feature from '../src/ol/Feature.js';\r\nimport Map from '../src/ol/Map.js';\r\nimport Point from '../src/ol/geom/Point.js';\r\nimport TileLayer from '../src/ol/layer/Tile.js';\r\nimport View from '../src/ol/View.js';\r\nimport WebGLPointsLayer from '../src/ol/layer/WebGLPoints.js';\r\nimport XYZ from '../src/ol/source/XYZ.js';\r\nimport {Vector} from '../src/ol/source.js';\r\nimport {fromLonLat} from '../src/ol/proj.js';\r\n\r\nconst key = 'get_your_own_D6rA4zTHduk6KOKTXzGB';\r\nconst attributions =\r\n  '<a href=\"https://www.maptiler.com/copyright/\" target=\"_blank\">&copy; MapTiler</a> ' +\r\n  '<a href=\"https://www.openstreetmap.org/copyright\" target=\"_blank\">&copy; OpenStreetMap contributors</a>';\r\n\r\nconst map = new Map({\r\n  layers: [\r\n    new TileLayer({\r\n      source: new XYZ({\r\n        attributions: attributions,\r\n        url:\r\n          'https://api.maptiler.com/tiles/satellite/{z}/{x}/{y}.jpg?key=' + key,\r\n        tileSize: 512,\r\n      }),\r\n    }),\r\n  ],\r\n  target: document.getElementById('map'),\r\n  view: new View({\r\n    center: [0, 4000000],\r\n    zoom: 2,\r\n  }),\r\n});\r\n\r\nconst vectorSource = new Vector({\r\n  features: [],\r\n  attributions: 'National UFO Reporting Center',\r\n});\r\n\r\nconst oldColor = [255, 160, 110];\r\nconst newColor = [180, 255, 200];\r\nconst size = 16;\r\n\r\nconst style = {\r\n  variables: {\r\n    filterShape: 'all',\r\n  },\r\n  filter: [\r\n    'case',\r\n    ['!=', ['var', 'filterShape'], 'all'],\r\n    ['==', ['get', 'shape'], ['var', 'filterShape']],\r\n    true,\r\n  ],\r\n  symbol: {\r\n    symbolType: 'image',\r\n    src: 'data/ufo_shapes.png',\r\n    size: size,\r\n    color: [\r\n      'interpolate',\r\n      ['linear'],\r\n      ['get', 'year'],\r\n      1950,\r\n      oldColor,\r\n      2013,\r\n      newColor,\r\n    ],\r\n    rotateWithView: false,\r\n    offset: [0, 0],\r\n    textureCoord: [\r\n      'match',\r\n      ['get', 'shape'],\r\n      'light',\r\n      [0, 0, 0.25, 0.5],\r\n      'sphere',\r\n      [0.25, 0, 0.5, 0.5],\r\n      'circle',\r\n      [0.25, 0, 0.5, 0.5],\r\n      'disc',\r\n      [0.5, 0, 0.75, 0.5],\r\n      'oval',\r\n      [0.5, 0, 0.75, 0.5],\r\n      'triangle',\r\n      [0.75, 0, 1, 0.5],\r\n      'fireball',\r\n      [0, 0.5, 0.25, 1],\r\n      [0.75, 0.5, 1, 1],\r\n    ],\r\n  },\r\n};\r\n\r\n// key is shape name, value is sightings count\r\nconst shapeTypes = {\r\n  all: 0,\r\n};\r\nconst shapeSelect = document.getElementById('shape-filter');\r\nshapeSelect.addEventListener('input', function () {\r\n  style.variables.filterShape =\r\n    shapeSelect.options[shapeSelect.selectedIndex].value;\r\n  map.render();\r\n});\r\nfunction fillShapeSelect() {\r\n  Object.keys(shapeTypes)\r\n    .sort(function (a, b) {\r\n      return shapeTypes[b] - shapeTypes[a];\r\n    })\r\n    .forEach(function (shape) {\r\n      const option = document.createElement('option');\r\n      option.text = `${shape} (${shapeTypes[shape]} sightings)`;\r\n      option.value = shape;\r\n      shapeSelect.appendChild(option);\r\n    });\r\n}\r\n\r\nconst client = new XMLHttpRequest();\r\nclient.open('GET', 'data/csv/ufo_sighting_data.csv');\r\nclient.onload = function () {\r\n  const csv = client.responseText;\r\n  const features = [];\r\n\r\n  let prevIndex = csv.indexOf('\\n') + 1; // scan past the header line\r\n\r\n  let curIndex;\r\n  while ((curIndex = csv.indexOf('\\n', prevIndex)) != -1) {\r\n    const line = csv.substr(prevIndex, curIndex - prevIndex).split(',');\r\n    prevIndex = curIndex + 1;\r\n\r\n    const coords = fromLonLat([parseFloat(line[5]), parseFloat(line[4])]);\r\n\r\n    // only keep valid points\r\n    if (isNaN(coords[0]) || isNaN(coords[1])) {\r\n      continue;\r\n    }\r\n\r\n    const shape = line[2];\r\n    shapeTypes[shape] = (shapeTypes[shape] ? shapeTypes[shape] : 0) + 1;\r\n    shapeTypes['all']++;\r\n\r\n    features.push(\r\n      new Feature({\r\n        datetime: line[0],\r\n        year: parseInt(/[0-9]{4}/.exec(line[0])[0]), // extract the year as int\r\n        shape: shape,\r\n        duration: line[3],\r\n        geometry: new Point(coords),\r\n      })\r\n    );\r\n  }\r\n  vectorSource.addFeatures(features);\r\n  fillShapeSelect();\r\n};\r\nclient.send();\r\n\r\nmap.addLayer(\r\n  new WebGLPointsLayer({\r\n    source: vectorSource,\r\n    style: style,\r\n  })\r\n);\r\n\r\nconst info = document.getElementById('info');\r\nmap.on('pointermove', function (evt) {\r\n  if (map.getView().getInteracting() || map.getView().getAnimating()) {\r\n    return;\r\n  }\r\n  const pixel = evt.pixel;\r\n  info.innerText = '';\r\n  map.forEachFeatureAtPixel(pixel, function (feature) {\r\n    const datetime = feature.get('datetime');\r\n    const duration = feature.get('duration');\r\n    const shape = feature.get('shape');\r\n    info.innerText =\r\n      'On ' +\r\n      datetime +\r\n      ', lasted ' +\r\n      duration +\r\n      ' seconds and had a \"' +\r\n      shape +\r\n      '\" shape.';\r\n  });\r\n});\r\n"],"sourceRoot":""}