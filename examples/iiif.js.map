{"version":3,"sources":["webpack:///../src/ol/format/IIIFInfo.js","webpack:///../src/ol/source/IIIF.js","webpack:///./iiif.js"],"names":["Versions","IIIF_PROFILE_VALUES","supports","formats","qualities","const","COMPLIANCE_VERSION1","COMPLIANCE_VERSION2","COMPLIANCE_VERSION3","versionFunctions","iiifInfo","let","levelProfile","getComplianceLevelSupportedFeatures","undefined","url","imageInfo","replace","resolutions","scale_factors","tileSize","tile_width","tile_height","additionalProfile","Array","isArray","profile","length","profileSupports","profileFormats","profileQualities","sizes","map","size","width","height","tiles","tile","scaleFactors","extraFormats","preferredFormat","preferredFormats","filter","format","includes","reduce","acc","extraFeatures","extraQualities","IIIFInfo","this","setImageInfo","JSON","parse","getImageApiVersion","context","i","getComplianceLevelEntryFromProfile","identifier","version","test","getComplianceLevelFromProfile","complianceLevel","level","match","getTileSourceOptions","opt_preferredOptions","options","imageOptions","quality","sort","a","b","formatPercentage","percentage","toLocaleString","maximumFractionDigits","opt_options","baseUrl","lastIndexOf","isNaN","tileWidth","tileHeight","maxZoom","tilePixelRatio","extent","supportsListedSizes","supportsListedTiles","Number","isInteger","supportsArbitraryTiling","Math","max","ceil","log","LN2","push","pow","maxScaleFactor","round","ignoredSizesIndex","resolution","splice","tileGrid","TileGrid","origin","IiifTileClass","bind","super","attributions","attributionsCollapsible","cacheSize","crossOrigin","imageSmoothing","projection","reprojectionErrorThreshold","state","tileClass","tileUrlFunction","tileCoord","pixelRatio","regionParam","sizeParam","zoom","tileX","tileY","scale","regionX","regionY","regionW","regionH","sizeW","sizeH","floor","regionWidth","regionHeight","transition","zDirection","Tile","Map","layers","target","notifyDiv","document","getElementById","urlInput","refreshMap","imageInfoUrl","fetch","then","response","json","iiifTileSource","setSource","setView","View","getTileGrid","getResolutions","getExtent","constrainOnlyCenter","getView","fit","textContent","catch","body","addEventListener","value"],"mappings":"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","file":"iiif.js","sourcesContent":["/**\r\n * @module ol/format/IIIFInfo\r\n */\r\n\r\nimport {assert} from '../asserts.js';\r\n\r\n/**\r\n * @typedef {Object} PreferredOptions\r\n * @property {string} [format] Preferred image format. Will be used if the image information\r\n * indicates support for that format.\r\n * @property {string} [quality] IIIF image qualitiy.  Will be used if the image information\r\n * indicates support for that quality.\r\n */\r\n\r\n/**\r\n * @typedef {Object} SupportedFeatures\r\n * @property {Array<string>} [supports] Supported IIIF image size and region\r\n * calculation features.\r\n * @property {Array<string>} [formats] Supported image formats.\r\n * @property {Array<string>} [qualities] Supported IIIF image qualities.\r\n */\r\n\r\n/**\r\n * @typedef {Object} TileInfo\r\n * @property {Array<number>} scaleFactors Supported resolution scaling factors.\r\n * @property {number} width Tile width in pixels.\r\n * @property {number} [height] Tile height in pixels. Same as tile width if height is\r\n * not given.\r\n */\r\n\r\n/**\r\n * @typedef {Object} IiifProfile\r\n * @property {Array<string>} [formats] Supported image formats for the image service.\r\n * @property {Array<string>} [qualities] Supported IIIF image qualities.\r\n * @property {Array<string>} [supports] Supported features.\r\n * @property {number} [maxArea] Maximum area (pixels) available for this image service.\r\n * @property {number} [maxHeight] Maximum height.\r\n * @property {number} [maxWidth] Maximum width.\r\n */\r\n\r\n/**\r\n * @typedef {Object<string,string|number|Array<number|string|IiifProfile>|Object<string, number>|TileInfo>}\r\n *    ImageInformationResponse\r\n */\r\n\r\n/**\r\n * Enum representing the major IIIF Image API versions\r\n * @enum {string}\r\n */\r\nexport const Versions = {\r\n  VERSION1: 'version1',\r\n  VERSION2: 'version2',\r\n  VERSION3: 'version3',\r\n};\r\n\r\n/**\r\n * Supported image formats, qualities and supported region / size calculation features\r\n * for different image API versions and compliance levels\r\n * @const\r\n * @type {Object<string, Object<string, SupportedFeatures>>}\r\n */\r\nconst IIIF_PROFILE_VALUES = {};\r\nIIIF_PROFILE_VALUES[Versions.VERSION1] = {\r\n  'level0': {\r\n    supports: [],\r\n    formats: [],\r\n    qualities: ['native'],\r\n  },\r\n  'level1': {\r\n    supports: ['regionByPx', 'sizeByW', 'sizeByH', 'sizeByPct'],\r\n    formats: ['jpg'],\r\n    qualities: ['native'],\r\n  },\r\n  'level2': {\r\n    supports: [\r\n      'regionByPx',\r\n      'regionByPct',\r\n      'sizeByW',\r\n      'sizeByH',\r\n      'sizeByPct',\r\n      'sizeByConfinedWh',\r\n      'sizeByWh',\r\n    ],\r\n    formats: ['jpg', 'png'],\r\n    qualities: ['native', 'color', 'grey', 'bitonal'],\r\n  },\r\n};\r\nIIIF_PROFILE_VALUES[Versions.VERSION2] = {\r\n  'level0': {\r\n    supports: [],\r\n    formats: ['jpg'],\r\n    qualities: ['default'],\r\n  },\r\n  'level1': {\r\n    supports: ['regionByPx', 'sizeByW', 'sizeByH', 'sizeByPct'],\r\n    formats: ['jpg'],\r\n    qualities: ['default'],\r\n  },\r\n  'level2': {\r\n    supports: [\r\n      'regionByPx',\r\n      'regionByPct',\r\n      'sizeByW',\r\n      'sizeByH',\r\n      'sizeByPct',\r\n      'sizeByConfinedWh',\r\n      'sizeByDistortedWh',\r\n      'sizeByWh',\r\n    ],\r\n    formats: ['jpg', 'png'],\r\n    qualities: ['default', 'bitonal'],\r\n  },\r\n};\r\nIIIF_PROFILE_VALUES[Versions.VERSION3] = {\r\n  'level0': {\r\n    supports: [],\r\n    formats: ['jpg'],\r\n    qualities: ['default'],\r\n  },\r\n  'level1': {\r\n    supports: ['regionByPx', 'regionSquare', 'sizeByW', 'sizeByH', 'sizeByWh'],\r\n    formats: ['jpg'],\r\n    qualities: ['default'],\r\n  },\r\n  'level2': {\r\n    supports: [\r\n      'regionByPx',\r\n      'regionSquare',\r\n      'regionByPct',\r\n      'sizeByW',\r\n      'sizeByH',\r\n      'sizeByPct',\r\n      'sizeByConfinedWh',\r\n      'sizeByWh',\r\n    ],\r\n    formats: ['jpg', 'png'],\r\n    qualities: ['default'],\r\n  },\r\n};\r\nIIIF_PROFILE_VALUES['none'] = {\r\n  'none': {\r\n    supports: [],\r\n    formats: [],\r\n    qualities: [],\r\n  },\r\n};\r\n\r\nconst COMPLIANCE_VERSION1 = /^https?:\\/\\/library\\.stanford\\.edu\\/iiif\\/image-api\\/(?:1\\.1\\/)?compliance\\.html#level[0-2]$/;\r\nconst COMPLIANCE_VERSION2 = /^https?:\\/\\/iiif\\.io\\/api\\/image\\/2\\/level[0-2](?:\\.json)?$/;\r\nconst COMPLIANCE_VERSION3 = /(^https?:\\/\\/iiif\\.io\\/api\\/image\\/3\\/level[0-2](?:\\.json)?$)|(^level[0-2]$)/;\r\n\r\nfunction generateVersion1Options(iiifInfo) {\r\n  let levelProfile = iiifInfo.getComplianceLevelSupportedFeatures();\r\n  // Version 1.0 and 1.1 do not require a profile.\r\n  if (levelProfile === undefined) {\r\n    levelProfile = IIIF_PROFILE_VALUES[Versions.VERSION1]['level0'];\r\n  }\r\n  return {\r\n    url:\r\n      iiifInfo.imageInfo['@id'] === undefined\r\n        ? undefined\r\n        : iiifInfo.imageInfo['@id'].replace(/\\/?(?:info\\.json)?$/g, ''),\r\n    supports: levelProfile.supports,\r\n    formats: [\r\n      ...levelProfile.formats,\r\n      iiifInfo.imageInfo.formats === undefined\r\n        ? []\r\n        : iiifInfo.imageInfo.formats,\r\n    ],\r\n    qualities: [\r\n      ...levelProfile.qualities,\r\n      iiifInfo.imageInfo.qualities === undefined\r\n        ? []\r\n        : iiifInfo.imageInfo.qualities,\r\n    ],\r\n    resolutions: iiifInfo.imageInfo.scale_factors,\r\n    tileSize:\r\n      iiifInfo.imageInfo.tile_width !== undefined\r\n        ? iiifInfo.imageInfo.tile_height !== undefined\r\n          ? [iiifInfo.imageInfo.tile_width, iiifInfo.imageInfo.tile_height]\r\n          : [iiifInfo.imageInfo.tile_width, iiifInfo.imageInfo.tile_width]\r\n        : iiifInfo.imageInfo.tile_height != undefined\r\n        ? [iiifInfo.imageInfo.tile_height, iiifInfo.imageInfo.tile_height]\r\n        : undefined,\r\n  };\r\n}\r\n\r\nfunction generateVersion2Options(iiifInfo) {\r\n  const levelProfile = iiifInfo.getComplianceLevelSupportedFeatures(),\r\n    additionalProfile =\r\n      Array.isArray(iiifInfo.imageInfo.profile) &&\r\n      iiifInfo.imageInfo.profile.length > 1,\r\n    profileSupports =\r\n      additionalProfile && iiifInfo.imageInfo.profile[1].supports\r\n        ? iiifInfo.imageInfo.profile[1].supports\r\n        : [],\r\n    profileFormats =\r\n      additionalProfile && iiifInfo.imageInfo.profile[1].formats\r\n        ? iiifInfo.imageInfo.profile[1].formats\r\n        : [],\r\n    profileQualities =\r\n      additionalProfile && iiifInfo.imageInfo.profile[1].qualities\r\n        ? iiifInfo.imageInfo.profile[1].qualities\r\n        : [];\r\n  return {\r\n    url: iiifInfo.imageInfo['@id'].replace(/\\/?(?:info\\.json)?$/g, ''),\r\n    sizes:\r\n      iiifInfo.imageInfo.sizes === undefined\r\n        ? undefined\r\n        : iiifInfo.imageInfo.sizes.map(function (size) {\r\n            return [size.width, size.height];\r\n          }),\r\n    tileSize:\r\n      iiifInfo.imageInfo.tiles === undefined\r\n        ? undefined\r\n        : [\r\n            iiifInfo.imageInfo.tiles.map(function (tile) {\r\n              return tile.width;\r\n            })[0],\r\n            iiifInfo.imageInfo.tiles.map(function (tile) {\r\n              return tile.height === undefined ? tile.width : tile.height;\r\n            })[0],\r\n          ],\r\n    resolutions:\r\n      iiifInfo.imageInfo.tiles === undefined\r\n        ? undefined\r\n        : iiifInfo.imageInfo.tiles.map(function (tile) {\r\n            return tile.scaleFactors;\r\n          })[0],\r\n    supports: [...levelProfile.supports, ...profileSupports],\r\n    formats: [...levelProfile.formats, ...profileFormats],\r\n    qualities: [...levelProfile.qualities, ...profileQualities],\r\n  };\r\n}\r\n\r\nfunction generateVersion3Options(iiifInfo) {\r\n  const levelProfile = iiifInfo.getComplianceLevelSupportedFeatures(),\r\n    formats =\r\n      iiifInfo.imageInfo.extraFormats === undefined\r\n        ? levelProfile.formats\r\n        : [...levelProfile.formats, ...iiifInfo.imageInfo.extraFormats],\r\n    preferredFormat =\r\n      iiifInfo.imageInfo.preferredFormats !== undefined &&\r\n      Array.isArray(iiifInfo.imageInfo.preferredFormats) &&\r\n      iiifInfo.imageInfo.preferredFormats.length > 0\r\n        ? iiifInfo.imageInfo.preferredFormats\r\n            .filter(function (format) {\r\n              return ['jpg', 'png', 'gif'].includes(format);\r\n            })\r\n            .reduce(function (acc, format) {\r\n              return acc === undefined && formats.includes(format)\r\n                ? format\r\n                : acc;\r\n            }, undefined)\r\n        : undefined;\r\n  return {\r\n    url: iiifInfo.imageInfo['id'],\r\n    sizes:\r\n      iiifInfo.imageInfo.sizes === undefined\r\n        ? undefined\r\n        : iiifInfo.imageInfo.sizes.map(function (size) {\r\n            return [size.width, size.height];\r\n          }),\r\n    tileSize:\r\n      iiifInfo.imageInfo.tiles === undefined\r\n        ? undefined\r\n        : [\r\n            iiifInfo.imageInfo.tiles.map(function (tile) {\r\n              return tile.width;\r\n            })[0],\r\n            iiifInfo.imageInfo.tiles.map(function (tile) {\r\n              return tile.height;\r\n            })[0],\r\n          ],\r\n    resolutions:\r\n      iiifInfo.imageInfo.tiles === undefined\r\n        ? undefined\r\n        : iiifInfo.imageInfo.tiles.map(function (tile) {\r\n            return tile.scaleFactors;\r\n          })[0],\r\n    supports:\r\n      iiifInfo.imageInfo.extraFeatures === undefined\r\n        ? levelProfile.supports\r\n        : [...levelProfile.supports, ...iiifInfo.imageInfo.extraFeatures],\r\n    formats: formats,\r\n    qualities:\r\n      iiifInfo.imageInfo.extraQualities === undefined\r\n        ? levelProfile.qualities\r\n        : [...levelProfile.qualities, ...iiifInfo.imageInfo.extraQualities],\r\n    preferredFormat: preferredFormat,\r\n  };\r\n}\r\n\r\nconst versionFunctions = {};\r\nversionFunctions[Versions.VERSION1] = generateVersion1Options;\r\nversionFunctions[Versions.VERSION2] = generateVersion2Options;\r\nversionFunctions[Versions.VERSION3] = generateVersion3Options;\r\n\r\n/**\r\n * @classdesc\r\n * Format for transforming IIIF Image API image information responses into\r\n * IIIF tile source ready options\r\n *\r\n * @api\r\n */\r\nclass IIIFInfo {\r\n  /**\r\n   * @param {string|ImageInformationResponse} imageInfo\r\n   * Deserialized image information JSON response object or JSON response as string\r\n   */\r\n  constructor(imageInfo) {\r\n    this.setImageInfo(imageInfo);\r\n  }\r\n\r\n  /**\r\n   * @param {string|ImageInformationResponse} imageInfo\r\n   * Deserialized image information JSON response object or JSON response as string\r\n   * @api\r\n   */\r\n  setImageInfo(imageInfo) {\r\n    if (typeof imageInfo == 'string') {\r\n      this.imageInfo = JSON.parse(imageInfo);\r\n    } else {\r\n      this.imageInfo = imageInfo;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @returns {Versions} Major IIIF version.\r\n   * @api\r\n   */\r\n  getImageApiVersion() {\r\n    if (this.imageInfo === undefined) {\r\n      return;\r\n    }\r\n    let context = this.imageInfo['@context'] || 'ol-no-context';\r\n    if (typeof context == 'string') {\r\n      context = [context];\r\n    }\r\n    for (let i = 0; i < context.length; i++) {\r\n      switch (context[i]) {\r\n        case 'http://library.stanford.edu/iiif/image-api/1.1/context.json':\r\n        case 'http://iiif.io/api/image/1/context.json':\r\n          return Versions.VERSION1;\r\n        case 'http://iiif.io/api/image/2/context.json':\r\n          return Versions.VERSION2;\r\n        case 'http://iiif.io/api/image/3/context.json':\r\n          return Versions.VERSION3;\r\n        case 'ol-no-context':\r\n          // Image API 1.0 has no '@context'\r\n          if (\r\n            this.getComplianceLevelEntryFromProfile(Versions.VERSION1) &&\r\n            this.imageInfo.identifier\r\n          ) {\r\n            return Versions.VERSION1;\r\n          }\r\n          break;\r\n        default:\r\n      }\r\n    }\r\n    assert(false, 61);\r\n  }\r\n\r\n  /**\r\n   * @param {Versions} version Optional IIIF image API version\r\n   * @returns {string} Compliance level as it appears in the IIIF image information\r\n   * response.\r\n   */\r\n  getComplianceLevelEntryFromProfile(version) {\r\n    if (this.imageInfo === undefined || this.imageInfo.profile === undefined) {\r\n      return;\r\n    }\r\n    if (version === undefined) {\r\n      version = this.getImageApiVersion();\r\n    }\r\n    switch (version) {\r\n      case Versions.VERSION1:\r\n        if (COMPLIANCE_VERSION1.test(this.imageInfo.profile)) {\r\n          return this.imageInfo.profile;\r\n        }\r\n        break;\r\n      case Versions.VERSION3:\r\n        if (COMPLIANCE_VERSION3.test(this.imageInfo.profile)) {\r\n          return this.imageInfo.profile;\r\n        }\r\n        break;\r\n      case Versions.VERSION2:\r\n        if (\r\n          typeof this.imageInfo.profile === 'string' &&\r\n          COMPLIANCE_VERSION2.test(this.imageInfo.profile)\r\n        ) {\r\n          return this.imageInfo.profile;\r\n        }\r\n        if (\r\n          Array.isArray(this.imageInfo.profile) &&\r\n          this.imageInfo.profile.length > 0 &&\r\n          typeof this.imageInfo.profile[0] === 'string' &&\r\n          COMPLIANCE_VERSION2.test(this.imageInfo.profile[0])\r\n        ) {\r\n          return this.imageInfo.profile[0];\r\n        }\r\n        break;\r\n      default:\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @param {Versions} version Optional IIIF image API version\r\n   * @returns {string} Compliance level, on of 'level0', 'level1' or 'level2' or undefined\r\n   */\r\n  getComplianceLevelFromProfile(version) {\r\n    const complianceLevel = this.getComplianceLevelEntryFromProfile(version);\r\n    if (complianceLevel === undefined) {\r\n      return undefined;\r\n    }\r\n    const level = complianceLevel.match(/level[0-2](?:\\.json)?$/g);\r\n    return Array.isArray(level) ? level[0].replace('.json', '') : undefined;\r\n  }\r\n\r\n  /**\r\n   * @returns {SupportedFeatures} Image formats, qualities and region / size calculation\r\n   * methods that are supported by the IIIF service.\r\n   */\r\n  getComplianceLevelSupportedFeatures() {\r\n    if (this.imageInfo === undefined) {\r\n      return;\r\n    }\r\n    const version = this.getImageApiVersion();\r\n    const level = this.getComplianceLevelFromProfile(version);\r\n    if (level === undefined) {\r\n      return IIIF_PROFILE_VALUES['none']['none'];\r\n    }\r\n    return IIIF_PROFILE_VALUES[version][level];\r\n  }\r\n\r\n  /**\r\n   * @param {PreferredOptions=} opt_preferredOptions Optional options for preferred format and quality.\r\n   * @returns {import(\"../source/IIIF.js\").Options} IIIF tile source ready constructor options.\r\n   * @api\r\n   */\r\n  getTileSourceOptions(opt_preferredOptions) {\r\n    const options = opt_preferredOptions || {},\r\n      version = this.getImageApiVersion();\r\n    if (version === undefined) {\r\n      return;\r\n    }\r\n    const imageOptions =\r\n      version === undefined ? undefined : versionFunctions[version](this);\r\n    if (imageOptions === undefined) {\r\n      return;\r\n    }\r\n    return {\r\n      url: imageOptions.url,\r\n      version: version,\r\n      size: [this.imageInfo.width, this.imageInfo.height],\r\n      sizes: imageOptions.sizes,\r\n      format:\r\n        options.format !== undefined &&\r\n        imageOptions.formats.includes(options.format)\r\n          ? options.format\r\n          : imageOptions.preferredFormat !== undefined\r\n          ? imageOptions.preferredFormat\r\n          : 'jpg',\r\n      supports: imageOptions.supports,\r\n      quality:\r\n        options.quality && imageOptions.qualities.includes(options.quality)\r\n          ? options.quality\r\n          : imageOptions.qualities.includes('native')\r\n          ? 'native'\r\n          : 'default',\r\n      resolutions: Array.isArray(imageOptions.resolutions)\r\n        ? imageOptions.resolutions.sort(function (a, b) {\r\n            return b - a;\r\n          })\r\n        : undefined,\r\n      tileSize: imageOptions.tileSize,\r\n    };\r\n  }\r\n}\r\n\r\nexport default IIIFInfo;\r\n","/**\r\n * @module ol/source/IIIF\r\n */\r\n\r\nimport TileGrid from '../tilegrid/TileGrid.js';\r\nimport TileImage from './TileImage.js';\r\nimport {CustomTile} from './Zoomify.js';\r\nimport {DEFAULT_TILE_SIZE} from '../tilegrid/common.js';\r\nimport {Versions} from '../format/IIIFInfo.js';\r\nimport {assert} from '../asserts.js';\r\nimport {getTopLeft} from '../extent.js';\r\nimport {toSize} from '../size.js';\r\n\r\n/**\r\n * @typedef {Object} Options\r\n * @property {import(\"./Source.js\").AttributionLike} [attributions] Attributions.\r\n * @property {boolean} [attributionsCollapsible=true] Attributions are collapsible.\r\n * @property {number} [cacheSize]\r\n * @property {null|string} [crossOrigin]\r\n * @property {import(\"../extent.js\").Extent} [extent=[0, -height, width, 0]]\r\n * @property {string} [format='jpg'] Requested image format.\r\n * @property {boolean} [imageSmoothing=true] Enable image smoothing.\r\n * @property {import(\"../proj.js\").ProjectionLike} [projection]\r\n * @property {string} [quality] Requested IIIF image quality. Default is 'native'\r\n * for version 1, 'default' for versions 2 and 3.\r\n * @property {number} [reprojectionErrorThreshold=0.5] Maximum allowed reprojection error (in pixels).\r\n * Higher values can increase reprojection performance, but decrease precision.\r\n * @property {Array<number>} [resolutions] Supported resolutions as given in IIIF 'scaleFactors'\r\n * @property {import(\"../size.js\").Size} size Size of the image [width, height].\r\n * @property {Array<import(\"../size.js\").Size>} [sizes] Supported scaled image sizes.\r\n * Content of the IIIF info.json 'sizes' property, but as array of Size objects.\r\n * @property {import(\"./State.js\").default} [state] Source state.\r\n * @property {Array<string>} [supports=[]] Supported IIIF region and size calculation\r\n * features.\r\n * @property {number} [tilePixelRatio]\r\n * @property {number|import(\"../size.js\").Size} [tileSize] Tile size.\r\n * Same tile size is used for all zoom levels. If tile size is a number,\r\n * a square tile is assumed. If the IIIF image service supports arbitrary\r\n * tiling (sizeByH, sizeByW, sizeByWh or sizeByPct as well as regionByPx or regionByPct\r\n * are supported), the default tilesize is 256.\r\n * @property {number} [transition]\r\n * @property {string} [url] Base URL of the IIIF Image service.\r\n * This should be the same as the IIIF Image ID.\r\n * @property {import(\"../format/IIIFInfo.js\").Versions} [version=Versions.VERSION2] Service's IIIF Image API version.\r\n * @property {number} [zDirection=0] Indicate which resolution should be used\r\n * by a renderer if the view resolution does not match any resolution of the tile source.\r\n * If 0, the nearest resolution will be used. If 1, the nearest lower resolution\r\n * will be used. If -1, the nearest higher resolution will be used.\r\n */\r\n\r\nfunction formatPercentage(percentage) {\r\n  return percentage.toLocaleString('en', {maximumFractionDigits: 10});\r\n}\r\n\r\n/**\r\n * @classdesc\r\n * Layer source for IIIF Image API services.\r\n * @api\r\n */\r\nclass IIIF extends TileImage {\r\n  /**\r\n   * @param {Options=} opt_options Tile source options. Use {@link import(\"../format/IIIFInfo.js\").IIIFInfo}\r\n   * to parse Image API service information responses into constructor options.\r\n   * @api\r\n   */\r\n  constructor(opt_options) {\r\n    /**\r\n     * @type {Partial<Options>}\r\n     */\r\n    const options = opt_options || {};\r\n\r\n    let baseUrl = options.url || '';\r\n    baseUrl =\r\n      baseUrl +\r\n      (baseUrl.lastIndexOf('/') === baseUrl.length - 1 || baseUrl === ''\r\n        ? ''\r\n        : '/');\r\n    const version = options.version || Versions.VERSION2;\r\n    const sizes = options.sizes || [];\r\n    const size = options.size;\r\n    assert(\r\n      size != undefined &&\r\n        Array.isArray(size) &&\r\n        size.length == 2 &&\r\n        !isNaN(size[0]) &&\r\n        size[0] > 0 &&\r\n        !isNaN(size[1]) &&\r\n        size[1] > 0,\r\n      60\r\n    );\r\n    const width = size[0];\r\n    const height = size[1];\r\n    const tileSize = options.tileSize;\r\n    const tilePixelRatio = options.tilePixelRatio || 1;\r\n    const format = options.format || 'jpg';\r\n    const quality =\r\n      options.quality ||\r\n      (options.version == Versions.VERSION1 ? 'native' : 'default');\r\n    let resolutions = options.resolutions || [];\r\n    const supports = options.supports || [];\r\n    const extent = options.extent || [0, -height, width, 0];\r\n\r\n    const supportsListedSizes =\r\n      sizes != undefined && Array.isArray(sizes) && sizes.length > 0;\r\n    const supportsListedTiles =\r\n      tileSize !== undefined &&\r\n      ((typeof tileSize === 'number' &&\r\n        Number.isInteger(tileSize) &&\r\n        tileSize > 0) ||\r\n        (Array.isArray(tileSize) && tileSize.length > 0));\r\n    const supportsArbitraryTiling =\r\n      supports != undefined &&\r\n      Array.isArray(supports) &&\r\n      (supports.includes('regionByPx') || supports.includes('regionByPct')) &&\r\n      (supports.includes('sizeByWh') ||\r\n        supports.includes('sizeByH') ||\r\n        supports.includes('sizeByW') ||\r\n        supports.includes('sizeByPct'));\r\n\r\n    let tileWidth, tileHeight, maxZoom;\r\n\r\n    resolutions.sort(function (a, b) {\r\n      return b - a;\r\n    });\r\n\r\n    if (supportsListedTiles || supportsArbitraryTiling) {\r\n      if (tileSize != undefined) {\r\n        if (\r\n          typeof tileSize === 'number' &&\r\n          Number.isInteger(tileSize) &&\r\n          tileSize > 0\r\n        ) {\r\n          tileWidth = tileSize;\r\n          tileHeight = tileSize;\r\n        } else if (Array.isArray(tileSize) && tileSize.length > 0) {\r\n          if (\r\n            tileSize.length == 1 ||\r\n            (tileSize[1] == undefined && Number.isInteger(tileSize[0]))\r\n          ) {\r\n            tileWidth = tileSize[0];\r\n            tileHeight = tileSize[0];\r\n          }\r\n          if (tileSize.length == 2) {\r\n            if (\r\n              Number.isInteger(tileSize[0]) &&\r\n              Number.isInteger(tileSize[1])\r\n            ) {\r\n              tileWidth = tileSize[0];\r\n              tileHeight = tileSize[1];\r\n            } else if (\r\n              tileSize[0] == undefined &&\r\n              Number.isInteger(tileSize[1])\r\n            ) {\r\n              tileWidth = tileSize[1];\r\n              tileHeight = tileSize[1];\r\n            }\r\n          }\r\n        }\r\n      }\r\n      if (tileWidth === undefined || tileHeight === undefined) {\r\n        tileWidth = DEFAULT_TILE_SIZE;\r\n        tileHeight = DEFAULT_TILE_SIZE;\r\n      }\r\n      if (resolutions.length == 0) {\r\n        maxZoom = Math.max(\r\n          Math.ceil(Math.log(width / tileWidth) / Math.LN2),\r\n          Math.ceil(Math.log(height / tileHeight) / Math.LN2)\r\n        );\r\n        for (let i = maxZoom; i >= 0; i--) {\r\n          resolutions.push(Math.pow(2, i));\r\n        }\r\n      } else {\r\n        const maxScaleFactor = Math.max(...resolutions);\r\n        // TODO maxScaleFactor might not be a power to 2\r\n        maxZoom = Math.round(Math.log(maxScaleFactor) / Math.LN2);\r\n      }\r\n    } else {\r\n      // No tile support.\r\n      tileWidth = width;\r\n      tileHeight = height;\r\n      resolutions = [];\r\n      if (supportsListedSizes) {\r\n        /*\r\n         * 'sizes' provided. Use full region in different resolutions. Every\r\n         * resolution has only one tile.\r\n         */\r\n        sizes.sort(function (a, b) {\r\n          return a[0] - b[0];\r\n        });\r\n        maxZoom = -1;\r\n        const ignoredSizesIndex = [];\r\n        for (let i = 0; i < sizes.length; i++) {\r\n          const resolution = width / sizes[i][0];\r\n          if (\r\n            resolutions.length > 0 &&\r\n            resolutions[resolutions.length - 1] == resolution\r\n          ) {\r\n            ignoredSizesIndex.push(i);\r\n            continue;\r\n          }\r\n          resolutions.push(resolution);\r\n          maxZoom++;\r\n        }\r\n        if (ignoredSizesIndex.length > 0) {\r\n          for (let i = 0; i < ignoredSizesIndex.length; i++) {\r\n            sizes.splice(ignoredSizesIndex[i] - i, 1);\r\n          }\r\n        }\r\n      } else {\r\n        // No useful image information at all. Try pseudo tile with full image.\r\n        resolutions.push(1);\r\n        sizes.push([width, height]);\r\n        maxZoom = 0;\r\n      }\r\n    }\r\n\r\n    const tileGrid = new TileGrid({\r\n      tileSize: [tileWidth, tileHeight],\r\n      extent: extent,\r\n      origin: getTopLeft(extent),\r\n      resolutions: resolutions,\r\n    });\r\n\r\n    const tileUrlFunction = function (tileCoord, pixelRatio, projection) {\r\n      let regionParam, sizeParam;\r\n      const zoom = tileCoord[0];\r\n      if (zoom > maxZoom) {\r\n        return;\r\n      }\r\n      const tileX = tileCoord[1],\r\n        tileY = tileCoord[2],\r\n        scale = resolutions[zoom];\r\n      if (\r\n        tileX === undefined ||\r\n        tileY === undefined ||\r\n        scale === undefined ||\r\n        tileX < 0 ||\r\n        Math.ceil(width / scale / tileWidth) <= tileX ||\r\n        tileY < 0 ||\r\n        Math.ceil(height / scale / tileHeight) <= tileY\r\n      ) {\r\n        return;\r\n      }\r\n      if (supportsArbitraryTiling || supportsListedTiles) {\r\n        const regionX = tileX * tileWidth * scale,\r\n          regionY = tileY * tileHeight * scale;\r\n        let regionW = tileWidth * scale,\r\n          regionH = tileHeight * scale,\r\n          sizeW = tileWidth,\r\n          sizeH = tileHeight;\r\n        if (regionX + regionW > width) {\r\n          regionW = width - regionX;\r\n        }\r\n        if (regionY + regionH > height) {\r\n          regionH = height - regionY;\r\n        }\r\n        if (regionX + tileWidth * scale > width) {\r\n          sizeW = Math.floor((width - regionX + scale - 1) / scale);\r\n        }\r\n        if (regionY + tileHeight * scale > height) {\r\n          sizeH = Math.floor((height - regionY + scale - 1) / scale);\r\n        }\r\n        if (\r\n          regionX == 0 &&\r\n          regionW == width &&\r\n          regionY == 0 &&\r\n          regionH == height\r\n        ) {\r\n          // canonical full image region parameter is 'full', not 'x,y,w,h'\r\n          regionParam = 'full';\r\n        } else if (\r\n          !supportsArbitraryTiling ||\r\n          supports.includes('regionByPx')\r\n        ) {\r\n          regionParam = regionX + ',' + regionY + ',' + regionW + ',' + regionH;\r\n        } else if (supports.includes('regionByPct')) {\r\n          const pctX = formatPercentage((regionX / width) * 100),\r\n            pctY = formatPercentage((regionY / height) * 100),\r\n            pctW = formatPercentage((regionW / width) * 100),\r\n            pctH = formatPercentage((regionH / height) * 100);\r\n          regionParam = 'pct:' + pctX + ',' + pctY + ',' + pctW + ',' + pctH;\r\n        }\r\n        if (\r\n          version == Versions.VERSION3 &&\r\n          (!supportsArbitraryTiling || supports.includes('sizeByWh'))\r\n        ) {\r\n          sizeParam = sizeW + ',' + sizeH;\r\n        } else if (!supportsArbitraryTiling || supports.includes('sizeByW')) {\r\n          sizeParam = sizeW + ',';\r\n        } else if (supports.includes('sizeByH')) {\r\n          sizeParam = ',' + sizeH;\r\n        } else if (supports.includes('sizeByWh')) {\r\n          sizeParam = sizeW + ',' + sizeH;\r\n        } else if (supports.includes('sizeByPct')) {\r\n          sizeParam = 'pct:' + formatPercentage(100 / scale);\r\n        }\r\n      } else {\r\n        regionParam = 'full';\r\n        if (supportsListedSizes) {\r\n          const regionWidth = sizes[zoom][0],\r\n            regionHeight = sizes[zoom][1];\r\n          if (version == Versions.VERSION3) {\r\n            if (regionWidth == width && regionHeight == height) {\r\n              sizeParam = 'max';\r\n            } else {\r\n              sizeParam = regionWidth + ',' + regionHeight;\r\n            }\r\n          } else {\r\n            if (regionWidth == width) {\r\n              sizeParam = 'full';\r\n            } else {\r\n              sizeParam = regionWidth + ',';\r\n            }\r\n          }\r\n        } else {\r\n          sizeParam = version == Versions.VERSION3 ? 'max' : 'full';\r\n        }\r\n      }\r\n      return (\r\n        baseUrl + regionParam + '/' + sizeParam + '/0/' + quality + '.' + format\r\n      );\r\n    };\r\n\r\n    const IiifTileClass = CustomTile.bind(\r\n      null,\r\n      toSize(tileSize || 256).map(function (size) {\r\n        return size * tilePixelRatio;\r\n      })\r\n    );\r\n\r\n    super({\r\n      attributions: options.attributions,\r\n      attributionsCollapsible: options.attributionsCollapsible,\r\n      cacheSize: options.cacheSize,\r\n      crossOrigin: options.crossOrigin,\r\n      imageSmoothing: options.imageSmoothing,\r\n      projection: options.projection,\r\n      reprojectionErrorThreshold: options.reprojectionErrorThreshold,\r\n      state: options.state,\r\n      tileClass: IiifTileClass,\r\n      tileGrid: tileGrid,\r\n      tilePixelRatio: options.tilePixelRatio,\r\n      tileUrlFunction: tileUrlFunction,\r\n      transition: options.transition,\r\n    });\r\n\r\n    /**\r\n     * @type {number}\r\n     */\r\n    this.zDirection = options.zDirection;\r\n  }\r\n}\r\n\r\nexport default IIIF;\r\n","import IIIF from '../src/ol/source/IIIF.js';\r\nimport IIIFInfo from '../src/ol/format/IIIFInfo.js';\r\nimport Map from '../src/ol/Map.js';\r\nimport TileLayer from '../src/ol/layer/Tile.js';\r\nimport View from '../src/ol/View.js';\r\n\r\nconst layer = new TileLayer(),\r\n  map = new Map({\r\n    layers: [layer],\r\n    target: 'map',\r\n  }),\r\n  notifyDiv = document.getElementById('iiif-notification'),\r\n  urlInput = document.getElementById('imageInfoUrl'),\r\n  displayButton = document.getElementById('display');\r\n\r\nfunction refreshMap(imageInfoUrl) {\r\n  fetch(imageInfoUrl)\r\n    .then(function (response) {\r\n      response\r\n        .json()\r\n        .then(function (imageInfo) {\r\n          const options = new IIIFInfo(imageInfo).getTileSourceOptions();\r\n          if (options === undefined || options.version === undefined) {\r\n            notifyDiv.textContent =\r\n              'Data seems to be no valid IIIF image information.';\r\n            return;\r\n          }\r\n          options.zDirection = -1;\r\n          const iiifTileSource = new IIIF(options);\r\n          layer.setSource(iiifTileSource);\r\n          map.setView(\r\n            new View({\r\n              resolutions: iiifTileSource.getTileGrid().getResolutions(),\r\n              extent: iiifTileSource.getTileGrid().getExtent(),\r\n              constrainOnlyCenter: true,\r\n            })\r\n          );\r\n          map.getView().fit(iiifTileSource.getTileGrid().getExtent());\r\n          notifyDiv.textContent = '';\r\n        })\r\n        .catch(function (body) {\r\n          notifyDiv.textContent = 'Could not read image info json. ' + body;\r\n        });\r\n    })\r\n    .catch(function () {\r\n      notifyDiv.textContent = 'Could not read data from URL.';\r\n    });\r\n}\r\n\r\ndisplayButton.addEventListener('click', function () {\r\n  refreshMap(urlInput.value);\r\n});\r\n\r\nrefreshMap(urlInput.value);\r\n"],"sourceRoot":""}