{"version":3,"sources":["webpack:///./color-manipulation.js"],"names":["const","let"],"mappings":"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","file":"color-manipulation.js","sourcesContent":["import ImageLayer from '../src/ol/layer/Image.js';\r\nimport Map from '../src/ol/Map.js';\r\nimport View from '../src/ol/View.js';\r\nimport {Raster as RasterSource, Stamen} from '../src/ol/source.js';\r\n\r\n/**\r\n * Color manipulation functions below are adapted from\r\n * https://github.com/d3/d3-color.\r\n */\r\nconst Xn = 0.95047;\r\nconst Yn = 1;\r\nconst Zn = 1.08883;\r\nconst t0 = 4 / 29;\r\nconst t1 = 6 / 29;\r\nconst t2 = 3 * t1 * t1;\r\nconst t3 = t1 * t1 * t1;\r\nconst twoPi = 2 * Math.PI;\r\n\r\n/**\r\n * Convert an RGB pixel into an HCL pixel.\r\n * @param {Array<number>} pixel A pixel in RGB space.\r\n * @return {Array<number>} A pixel in HCL space.\r\n */\r\nfunction rgb2hcl(pixel) {\r\n  const red = rgb2xyz(pixel[0]);\r\n  const green = rgb2xyz(pixel[1]);\r\n  const blue = rgb2xyz(pixel[2]);\r\n\r\n  const x = xyz2lab(\r\n    (0.4124564 * red + 0.3575761 * green + 0.1804375 * blue) / Xn\r\n  );\r\n  const y = xyz2lab(\r\n    (0.2126729 * red + 0.7151522 * green + 0.072175 * blue) / Yn\r\n  );\r\n  const z = xyz2lab(\r\n    (0.0193339 * red + 0.119192 * green + 0.9503041 * blue) / Zn\r\n  );\r\n\r\n  const l = 116 * y - 16;\r\n  const a = 500 * (x - y);\r\n  const b = 200 * (y - z);\r\n\r\n  const c = Math.sqrt(a * a + b * b);\r\n  let h = Math.atan2(b, a);\r\n  if (h < 0) {\r\n    h += twoPi;\r\n  }\r\n\r\n  pixel[0] = h;\r\n  pixel[1] = c;\r\n  pixel[2] = l;\r\n\r\n  return pixel;\r\n}\r\n\r\n/**\r\n * Convert an HCL pixel into an RGB pixel.\r\n * @param {Array<number>} pixel A pixel in HCL space.\r\n * @return {Array<number>} A pixel in RGB space.\r\n */\r\nfunction hcl2rgb(pixel) {\r\n  const h = pixel[0];\r\n  const c = pixel[1];\r\n  const l = pixel[2];\r\n\r\n  const a = Math.cos(h) * c;\r\n  const b = Math.sin(h) * c;\r\n\r\n  let y = (l + 16) / 116;\r\n  let x = isNaN(a) ? y : y + a / 500;\r\n  let z = isNaN(b) ? y : y - b / 200;\r\n\r\n  y = Yn * lab2xyz(y);\r\n  x = Xn * lab2xyz(x);\r\n  z = Zn * lab2xyz(z);\r\n\r\n  pixel[0] = xyz2rgb(3.2404542 * x - 1.5371385 * y - 0.4985314 * z);\r\n  pixel[1] = xyz2rgb(-0.969266 * x + 1.8760108 * y + 0.041556 * z);\r\n  pixel[2] = xyz2rgb(0.0556434 * x - 0.2040259 * y + 1.0572252 * z);\r\n\r\n  return pixel;\r\n}\r\n\r\nfunction xyz2lab(t) {\r\n  return t > t3 ? Math.pow(t, 1 / 3) : t / t2 + t0;\r\n}\r\n\r\nfunction lab2xyz(t) {\r\n  return t > t1 ? t * t * t : t2 * (t - t0);\r\n}\r\n\r\nfunction rgb2xyz(x) {\r\n  return (x /= 255) <= 0.04045 ? x / 12.92 : Math.pow((x + 0.055) / 1.055, 2.4);\r\n}\r\n\r\nfunction xyz2rgb(x) {\r\n  return (\r\n    255 * (x <= 0.0031308 ? 12.92 * x : 1.055 * Math.pow(x, 1 / 2.4) - 0.055)\r\n  );\r\n}\r\n\r\nconst raster = new RasterSource({\r\n  sources: [\r\n    new Stamen({\r\n      layer: 'watercolor',\r\n    }),\r\n  ],\r\n  operation: function (pixels, data) {\r\n    const hcl = rgb2hcl(pixels[0]);\r\n\r\n    let h = hcl[0] + (Math.PI * data.hue) / 180;\r\n    if (h < 0) {\r\n      h += twoPi;\r\n    } else if (h > twoPi) {\r\n      h -= twoPi;\r\n    }\r\n    hcl[0] = h;\r\n\r\n    hcl[1] *= data.chroma / 100;\r\n    hcl[2] *= data.lightness / 100;\r\n\r\n    return hcl2rgb(hcl);\r\n  },\r\n  lib: {\r\n    rgb2hcl: rgb2hcl,\r\n    hcl2rgb: hcl2rgb,\r\n    rgb2xyz: rgb2xyz,\r\n    lab2xyz: lab2xyz,\r\n    xyz2lab: xyz2lab,\r\n    xyz2rgb: xyz2rgb,\r\n    Xn: Xn,\r\n    Yn: Yn,\r\n    Zn: Zn,\r\n    t0: t0,\r\n    t1: t1,\r\n    t2: t2,\r\n    t3: t3,\r\n    twoPi: twoPi,\r\n  },\r\n});\r\n\r\nconst controls = {};\r\n\r\nraster.on('beforeoperations', function (event) {\r\n  const data = event.data;\r\n  for (const id in controls) {\r\n    data[id] = Number(controls[id].value);\r\n  }\r\n});\r\n\r\nconst map = new Map({\r\n  layers: [\r\n    new ImageLayer({\r\n      source: raster,\r\n    }),\r\n  ],\r\n  target: 'map',\r\n  view: new View({\r\n    center: [0, 2500000],\r\n    zoom: 2,\r\n    maxZoom: 18,\r\n  }),\r\n});\r\n\r\nconst controlIds = ['hue', 'chroma', 'lightness'];\r\ncontrolIds.forEach(function (id) {\r\n  const control = document.getElementById(id);\r\n  const output = document.getElementById(id + 'Out');\r\n  control.addEventListener('input', function () {\r\n    output.innerText = control.value;\r\n    raster.changed();\r\n  });\r\n  output.innerText = control.value;\r\n  controls[id] = control;\r\n});\r\n"],"sourceRoot":""}