{"version":3,"sources":["webpack:///./style-renderer.js"],"names":["fill","stroke","color","width","style","renderer","pixelCoordinates","state","const","context","geometry","clone","setCoordinates","extent","getExtent","height","flag","feature","get","save","renderContext","pixelRatio","setFillStrokeStyle","drawGeometry","clip","bottomLeft","left","bottom","drawImage","restore","vectorLayer","source","url","format","getSource","on","event","img","Image","onload","set","src","toLowerCase","layers","target","view","center","zoom"],"mappings":"4FAAA,wFASMA,EAAO,IAAI,IACXC,EAAS,IAAI,IAAO,CACxBC,MAAO,wBACPC,MAAO,IAEHC,EAAQ,IAAI,IAAM,CACtBC,SAAU,SAAUC,EAAkBC,GACpCC,IAAMC,EAAUF,EAAME,QAChBC,EAAWH,EAAMG,SAASC,QAChCD,EAASE,eAAeN,GACxBE,IAAMK,EAASH,EAASI,YAClBX,EAAQ,YAASU,GACjBE,EAAS,YAAUF,GACnBG,EAAOT,EAAMU,QAAQC,IAAI,QAC/B,MAAKF,GAAQD,EAAS,GAAKZ,EAAQ,GAAnC,CAKAM,EAAQU,OACRX,IAAMY,EAAgB,YAAUX,EAAS,CACvCY,WAAY,IAEdD,EAAcE,mBAAmBtB,EAAMC,GACvCmB,EAAcG,aAAab,GAC3BD,EAAQe,OAGRhB,IAAMiB,EAAa,YAAcZ,GAC3Ba,EAAOD,EAAW,GAClBE,EAASF,EAAW,GAC1BhB,EAAQmB,UAAUZ,EAAMU,EAAMC,EAAQxB,EAAOY,GAC7CN,EAAQoB,cAINC,EAAc,IAAI,IAAY,CAClCC,OAAQ,IAAI,IAAa,CACvBC,IACE,yFACFC,OAAQ,IAAI,MAEd7B,MAAOA,IAIT0B,EAAYI,YAAYC,GAAG,cAAc,SAAUC,GACjD5B,IAAMS,EAAUmB,EAAMnB,QAChBoB,EAAM,IAAIC,MAChBD,EAAIE,OAAS,WACXtB,EAAQuB,IAAI,OAAQH,IAEtBA,EAAII,IACF,4BAA8BxB,EAAQC,IAAI,UAAUwB,cAAgB,UAGxE,IAAI,IAAI,CACNC,OAAQ,CAACb,GACTc,OAAQ,MACRC,KAAM,IAAI,IAAK,CACbC,OAAQ,CAAC,EAAG,GACZC,KAAM,Q","file":"style-renderer.js","sourcesContent":["import GeoJSON from '../src/ol/format/GeoJSON.js';\r\nimport Map from '../src/ol/Map.js';\r\nimport VectorLayer from '../src/ol/layer/Vector.js';\r\nimport VectorSource from '../src/ol/source/Vector.js';\r\nimport View from '../src/ol/View.js';\r\nimport {Fill, Stroke, Style} from '../src/ol/style.js';\r\nimport {getBottomLeft, getHeight, getWidth} from '../src/ol/extent.js';\r\nimport {toContext} from '../src/ol/render.js';\r\n\r\nconst fill = new Fill();\r\nconst stroke = new Stroke({\r\n  color: 'rgba(255,255,255,0.8)',\r\n  width: 2,\r\n});\r\nconst style = new Style({\r\n  renderer: function (pixelCoordinates, state) {\r\n    const context = state.context;\r\n    const geometry = state.geometry.clone();\r\n    geometry.setCoordinates(pixelCoordinates);\r\n    const extent = geometry.getExtent();\r\n    const width = getWidth(extent);\r\n    const height = getHeight(extent);\r\n    const flag = state.feature.get('flag');\r\n    if (!flag || height < 1 || width < 1) {\r\n      return;\r\n    }\r\n\r\n    // Stitch out country shape from the blue canvas\r\n    context.save();\r\n    const renderContext = toContext(context, {\r\n      pixelRatio: 1,\r\n    });\r\n    renderContext.setFillStrokeStyle(fill, stroke);\r\n    renderContext.drawGeometry(geometry);\r\n    context.clip();\r\n\r\n    // Fill transparent country with the flag image\r\n    const bottomLeft = getBottomLeft(extent);\r\n    const left = bottomLeft[0];\r\n    const bottom = bottomLeft[1];\r\n    context.drawImage(flag, left, bottom, width, height);\r\n    context.restore();\r\n  },\r\n});\r\n\r\nconst vectorLayer = new VectorLayer({\r\n  source: new VectorSource({\r\n    url:\r\n      'https://openlayersbook.github.io/openlayers_book_samples/assets/data/countries.geojson',\r\n    format: new GeoJSON(),\r\n  }),\r\n  style: style,\r\n});\r\n\r\n// Load country flags and set them as `flag` attribute on the country feature\r\nvectorLayer.getSource().on('addfeature', function (event) {\r\n  const feature = event.feature;\r\n  const img = new Image();\r\n  img.onload = function () {\r\n    feature.set('flag', img);\r\n  };\r\n  img.src =\r\n    'https://flagcdn.com/w320/' + feature.get('iso_a2').toLowerCase() + '.png';\r\n});\r\n\r\nnew Map({\r\n  layers: [vectorLayer],\r\n  target: 'map',\r\n  view: new View({\r\n    center: [0, 0],\r\n    zoom: 1,\r\n  }),\r\n});\r\n"],"sourceRoot":""}