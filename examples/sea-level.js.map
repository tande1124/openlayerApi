{"version":3,"sources":["webpack:///./sea-level.js"],"names":["const","key","elevation","source","url","maxZoom","crossOrigin","on","evt","context","imageSmoothingEnabled","msImageSmoothingEnabled","raster","sources","operation","pixels","data","pixel","level","map","target","layers","attributions","tileSize","opacity","view","center","zoom","control","document","getElementById","output","addEventListener","innerText","value","changed","event","locations","getElementsByClassName","i","ii","length","relocate","dataset","getView","setCenter","split","Number","setZoom"],"mappings":"4FAAA,gEAuBAA,IAAMC,EAAM,oCAKNC,EAAY,IAAI,IAAU,CAC9BC,OAAQ,IAAI,IAAI,CACdC,IACE,kEAAoEH,EACtEI,QAAS,GACTC,YAAa,OAGjBJ,EAAUK,GAAG,aAAa,SAAUC,GAClCA,EAAIC,QAAQC,uBAAwB,EACpCF,EAAIC,QAAQE,yBAA0B,KAGxCX,IAAMY,EAAS,IAAI,IAAa,CAC9BC,QAAS,CAACX,GACVY,UArCF,SAAeC,EAAQC,GACrBhB,IAAMiB,EAAQF,EAAO,GAarB,OAZIE,EAAM,KAEwD,IAAzC,IAAXA,EAAM,GAAW,IAAiB,IAAXA,EAAM,GAAWA,EAAM,IAAvD,KACWD,EAAKE,OACjBD,EAAM,GAAK,IACXA,EAAM,GAAK,IACXA,EAAM,GAAK,IACXA,EAAM,GAAK,KAEXA,EAAM,GAAK,GAGRA,KA0BHE,EAAM,IAAI,IAAI,CAClBC,OAAQ,MACRC,OAAQ,CACN,IAAI,IAAU,CACZlB,OAAQ,IAAI,IAAI,CACdmB,aA1BN,4LA2BMlB,IAAK,6DAA+DH,EACpEsB,SAAU,QAGd,IAAI,IAAW,CACbC,QAAS,GACTrB,OAAQS,KAGZa,KAAM,IAAI,IAAK,CACbC,OAAQ,YAAW,EAAE,SAAU,UAC/BC,KAAM,OAIJC,EAAUC,SAASC,eAAe,SAClCC,EAASF,SAASC,eAAe,UACvCF,EAAQI,iBAAiB,SAAS,WAChCD,EAAOE,UAAYL,EAAQM,MAC3BtB,EAAOuB,aAETJ,EAAOE,UAAYL,EAAQM,MAE3BtB,EAAOL,GAAG,oBAAoB,SAAU6B,GACtCA,EAAMpB,KAAKE,MAAQU,EAAQM,SAI7B,IADAlC,IAAMqC,EAAYR,SAASS,uBAAuB,YACzCC,EAAI,EAAGC,EAAKH,EAAUI,OAAQF,EAAIC,IAAMD,EAC/CF,EAAUE,GAAGP,iBAAiB,QAASU,GAGzC,SAASA,EAASN,GAChBpC,IAAMgB,EAAOoB,EAAMhB,OAAOuB,QACpBlB,EAAON,EAAIyB,UACjBnB,EAAKoB,UAAU,YAAW7B,EAAKU,OAAOoB,MAAM,KAAK3B,IAAI4B,UACrDtB,EAAKuB,QAAQD,OAAO/B,EAAKW,U","file":"sea-level.js","sourcesContent":["import Map from '../src/ol/Map.js';\r\nimport View from '../src/ol/View.js';\r\nimport {Image as ImageLayer, Tile as TileLayer} from '../src/ol/layer.js';\r\nimport {Raster as RasterSource, XYZ} from '../src/ol/source.js';\r\nimport {fromLonLat} from '../src/ol/proj.js';\r\n\r\nfunction flood(pixels, data) {\r\n  const pixel = pixels[0];\r\n  if (pixel[3]) {\r\n    const height =\r\n      -10000 + (pixel[0] * 256 * 256 + pixel[1] * 256 + pixel[2]) * 0.1;\r\n    if (height <= data.level) {\r\n      pixel[0] = 134;\r\n      pixel[1] = 203;\r\n      pixel[2] = 249;\r\n      pixel[3] = 255;\r\n    } else {\r\n      pixel[3] = 0;\r\n    }\r\n  }\r\n  return pixel;\r\n}\r\n\r\nconst key = 'get_your_own_D6rA4zTHduk6KOKTXzGB';\r\nconst attributions =\r\n  '<a href=\"https://www.maptiler.com/copyright/\" target=\"_blank\">&copy; MapTiler</a> ' +\r\n  '<a href=\"https://www.openstreetmap.org/copyright\" target=\"_blank\">&copy; OpenStreetMap contributors</a>';\r\n\r\nconst elevation = new TileLayer({\r\n  source: new XYZ({\r\n    url:\r\n      'https://api.maptiler.com/tiles/terrain-rgb/{z}/{x}/{y}.png?key=' + key,\r\n    maxZoom: 10,\r\n    crossOrigin: '',\r\n  }),\r\n});\r\nelevation.on('prerender', function (evt) {\r\n  evt.context.imageSmoothingEnabled = false;\r\n  evt.context.msImageSmoothingEnabled = false;\r\n});\r\n\r\nconst raster = new RasterSource({\r\n  sources: [elevation],\r\n  operation: flood,\r\n});\r\n\r\nconst map = new Map({\r\n  target: 'map',\r\n  layers: [\r\n    new TileLayer({\r\n      source: new XYZ({\r\n        attributions: attributions,\r\n        url: 'https://api.maptiler.com/maps/streets/{z}/{x}/{y}.png?key=' + key,\r\n        tileSize: 512,\r\n      }),\r\n    }),\r\n    new ImageLayer({\r\n      opacity: 0.6,\r\n      source: raster,\r\n    }),\r\n  ],\r\n  view: new View({\r\n    center: fromLonLat([-122.3267, 37.8377]),\r\n    zoom: 11,\r\n  }),\r\n});\r\n\r\nconst control = document.getElementById('level');\r\nconst output = document.getElementById('output');\r\ncontrol.addEventListener('input', function () {\r\n  output.innerText = control.value;\r\n  raster.changed();\r\n});\r\noutput.innerText = control.value;\r\n\r\nraster.on('beforeoperations', function (event) {\r\n  event.data.level = control.value;\r\n});\r\n\r\nconst locations = document.getElementsByClassName('location');\r\nfor (let i = 0, ii = locations.length; i < ii; ++i) {\r\n  locations[i].addEventListener('click', relocate);\r\n}\r\n\r\nfunction relocate(event) {\r\n  const data = event.target.dataset;\r\n  const view = map.getView();\r\n  view.setCenter(fromLonLat(data.center.split(',').map(Number)));\r\n  view.setZoom(Number(data.zoom));\r\n}\r\n"],"sourceRoot":""}