{"version":3,"sources":["webpack:///./vector-labels.js"],"names":["openSansAdded","myDom","points","text","document","getElementById","align","baseline","rotation","font","weight","size","height","offsetX","offsetY","color","outline","outlineWidth","maxreso","lines","placement","maxangle","overflow","polygons","getText","feature","resolution","dom","const","type","value","maxResolution","get","trunc","stringDivider","createTextStyle","parseInt","undefined","maxAngle","parseFloat","openSans","createElement","href","rel","getElementsByTagName","appendChild","fillColor","outlineColor","textAlign","textBaseline","fill","stroke","width","polygonStyleFunction","vectorPolygons","source","url","format","style","lineStyleFunction","vectorLines","pointStyleFunction","image","radius","vectorPoints","layers","target","view","center","zoom","str","spaceReplacer","length","let","p","substring","addEventListener","setStyle","String","prototype","n","this","substr"],"mappings":"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","file":"vector-labels.js","sourcesContent":["import GeoJSON from '../src/ol/format/GeoJSON.js';\r\nimport Map from '../src/ol/Map.js';\r\nimport View from '../src/ol/View.js';\r\nimport {\r\n  Circle as CircleStyle,\r\n  Fill,\r\n  Stroke,\r\n  Style,\r\n  Text,\r\n} from '../src/ol/style.js';\r\nimport {OSM, Vector as VectorSource} from '../src/ol/source.js';\r\nimport {Tile as TileLayer, Vector as VectorLayer} from '../src/ol/layer.js';\r\n\r\nlet openSansAdded = false;\r\n\r\nconst myDom = {\r\n  points: {\r\n    text: document.getElementById('points-text'),\r\n    align: document.getElementById('points-align'),\r\n    baseline: document.getElementById('points-baseline'),\r\n    rotation: document.getElementById('points-rotation'),\r\n    font: document.getElementById('points-font'),\r\n    weight: document.getElementById('points-weight'),\r\n    size: document.getElementById('points-size'),\r\n    height: document.getElementById('points-height'),\r\n    offsetX: document.getElementById('points-offset-x'),\r\n    offsetY: document.getElementById('points-offset-y'),\r\n    color: document.getElementById('points-color'),\r\n    outline: document.getElementById('points-outline'),\r\n    outlineWidth: document.getElementById('points-outline-width'),\r\n    maxreso: document.getElementById('points-maxreso'),\r\n  },\r\n  lines: {\r\n    text: document.getElementById('lines-text'),\r\n    align: document.getElementById('lines-align'),\r\n    baseline: document.getElementById('lines-baseline'),\r\n    rotation: document.getElementById('lines-rotation'),\r\n    font: document.getElementById('lines-font'),\r\n    weight: document.getElementById('lines-weight'),\r\n    placement: document.getElementById('lines-placement'),\r\n    maxangle: document.getElementById('lines-maxangle'),\r\n    overflow: document.getElementById('lines-overflow'),\r\n    size: document.getElementById('lines-size'),\r\n    height: document.getElementById('lines-height'),\r\n    offsetX: document.getElementById('lines-offset-x'),\r\n    offsetY: document.getElementById('lines-offset-y'),\r\n    color: document.getElementById('lines-color'),\r\n    outline: document.getElementById('lines-outline'),\r\n    outlineWidth: document.getElementById('lines-outline-width'),\r\n    maxreso: document.getElementById('lines-maxreso'),\r\n  },\r\n  polygons: {\r\n    text: document.getElementById('polygons-text'),\r\n    align: document.getElementById('polygons-align'),\r\n    baseline: document.getElementById('polygons-baseline'),\r\n    rotation: document.getElementById('polygons-rotation'),\r\n    font: document.getElementById('polygons-font'),\r\n    weight: document.getElementById('polygons-weight'),\r\n    placement: document.getElementById('polygons-placement'),\r\n    maxangle: document.getElementById('polygons-maxangle'),\r\n    overflow: document.getElementById('polygons-overflow'),\r\n    size: document.getElementById('polygons-size'),\r\n    height: document.getElementById('polygons-height'),\r\n    offsetX: document.getElementById('polygons-offset-x'),\r\n    offsetY: document.getElementById('polygons-offset-y'),\r\n    color: document.getElementById('polygons-color'),\r\n    outline: document.getElementById('polygons-outline'),\r\n    outlineWidth: document.getElementById('polygons-outline-width'),\r\n    maxreso: document.getElementById('polygons-maxreso'),\r\n  },\r\n};\r\n\r\nconst getText = function (feature, resolution, dom) {\r\n  const type = dom.text.value;\r\n  const maxResolution = dom.maxreso.value;\r\n  let text = feature.get('name');\r\n\r\n  if (resolution > maxResolution) {\r\n    text = '';\r\n  } else if (type == 'hide') {\r\n    text = '';\r\n  } else if (type == 'shorten') {\r\n    text = text.trunc(12);\r\n  } else if (\r\n    type == 'wrap' &&\r\n    (!dom.placement || dom.placement.value != 'line')\r\n  ) {\r\n    text = stringDivider(text, 16, '\\n');\r\n  }\r\n\r\n  return text;\r\n};\r\n\r\nconst createTextStyle = function (feature, resolution, dom) {\r\n  const align = dom.align.value;\r\n  const baseline = dom.baseline.value;\r\n  const size = dom.size.value;\r\n  const height = dom.height.value;\r\n  const offsetX = parseInt(dom.offsetX.value, 10);\r\n  const offsetY = parseInt(dom.offsetY.value, 10);\r\n  const weight = dom.weight.value;\r\n  const placement = dom.placement ? dom.placement.value : undefined;\r\n  const maxAngle = dom.maxangle ? parseFloat(dom.maxangle.value) : undefined;\r\n  const overflow = dom.overflow ? dom.overflow.value == 'true' : undefined;\r\n  const rotation = parseFloat(dom.rotation.value);\r\n  if (dom.font.value == \"'Open Sans'\" && !openSansAdded) {\r\n    const openSans = document.createElement('link');\r\n    openSans.href = 'https://fonts.googleapis.com/css?family=Open+Sans';\r\n    openSans.rel = 'stylesheet';\r\n    document.getElementsByTagName('head')[0].appendChild(openSans);\r\n    openSansAdded = true;\r\n  }\r\n  const font = weight + ' ' + size + '/' + height + ' ' + dom.font.value;\r\n  const fillColor = dom.color.value;\r\n  const outlineColor = dom.outline.value;\r\n  const outlineWidth = parseInt(dom.outlineWidth.value, 10);\r\n\r\n  return new Text({\r\n    textAlign: align == '' ? undefined : align,\r\n    textBaseline: baseline,\r\n    font: font,\r\n    text: getText(feature, resolution, dom),\r\n    fill: new Fill({color: fillColor}),\r\n    stroke: new Stroke({color: outlineColor, width: outlineWidth}),\r\n    offsetX: offsetX,\r\n    offsetY: offsetY,\r\n    placement: placement,\r\n    maxAngle: maxAngle,\r\n    overflow: overflow,\r\n    rotation: rotation,\r\n  });\r\n};\r\n\r\n// Polygons\r\nfunction polygonStyleFunction(feature, resolution) {\r\n  return new Style({\r\n    stroke: new Stroke({\r\n      color: 'blue',\r\n      width: 1,\r\n    }),\r\n    fill: new Fill({\r\n      color: 'rgba(0, 0, 255, 0.1)',\r\n    }),\r\n    text: createTextStyle(feature, resolution, myDom.polygons),\r\n  });\r\n}\r\n\r\nconst vectorPolygons = new VectorLayer({\r\n  source: new VectorSource({\r\n    url: 'data/geojson/polygon-samples.geojson',\r\n    format: new GeoJSON(),\r\n  }),\r\n  style: polygonStyleFunction,\r\n});\r\n\r\n// Lines\r\nfunction lineStyleFunction(feature, resolution) {\r\n  return new Style({\r\n    stroke: new Stroke({\r\n      color: 'green',\r\n      width: 2,\r\n    }),\r\n    text: createTextStyle(feature, resolution, myDom.lines),\r\n  });\r\n}\r\n\r\nconst vectorLines = new VectorLayer({\r\n  source: new VectorSource({\r\n    url: 'data/geojson/line-samples.geojson',\r\n    format: new GeoJSON(),\r\n  }),\r\n  style: lineStyleFunction,\r\n});\r\n\r\n// Points\r\nfunction pointStyleFunction(feature, resolution) {\r\n  return new Style({\r\n    image: new CircleStyle({\r\n      radius: 10,\r\n      fill: new Fill({color: 'rgba(255, 0, 0, 0.1)'}),\r\n      stroke: new Stroke({color: 'red', width: 1}),\r\n    }),\r\n    text: createTextStyle(feature, resolution, myDom.points),\r\n  });\r\n}\r\n\r\nconst vectorPoints = new VectorLayer({\r\n  source: new VectorSource({\r\n    url: 'data/geojson/point-samples.geojson',\r\n    format: new GeoJSON(),\r\n  }),\r\n  style: pointStyleFunction,\r\n});\r\n\r\nconst map = new Map({\r\n  layers: [\r\n    new TileLayer({\r\n      source: new OSM(),\r\n    }),\r\n    vectorPolygons,\r\n    vectorLines,\r\n    vectorPoints,\r\n  ],\r\n  target: 'map',\r\n  view: new View({\r\n    center: [-8161939, 6095025],\r\n    zoom: 8,\r\n  }),\r\n});\r\n\r\ndocument\r\n  .getElementById('refresh-points')\r\n  .addEventListener('click', function () {\r\n    vectorPoints.setStyle(pointStyleFunction);\r\n  });\r\n\r\ndocument.getElementById('refresh-lines').addEventListener('click', function () {\r\n  vectorLines.setStyle(lineStyleFunction);\r\n});\r\n\r\ndocument\r\n  .getElementById('refresh-polygons')\r\n  .addEventListener('click', function () {\r\n    vectorPolygons.setStyle(polygonStyleFunction);\r\n  });\r\n\r\n/**\r\n * @param {number} n The max number of characters to keep.\r\n * @return {string} Truncated string.\r\n */\r\nString.prototype.trunc =\r\n  String.prototype.trunc ||\r\n  function (n) {\r\n    return this.length > n ? this.substr(0, n - 1) + '...' : this.substr(0);\r\n  };\r\n\r\n// http://stackoverflow.com/questions/14484787/wrap-text-in-javascript\r\nfunction stringDivider(str, width, spaceReplacer) {\r\n  if (str.length > width) {\r\n    let p = width;\r\n    while (p > 0 && str[p] != ' ' && str[p] != '-') {\r\n      p--;\r\n    }\r\n    if (p > 0) {\r\n      let left;\r\n      if (str.substring(p, p + 1) == '-') {\r\n        left = str.substring(0, p + 1);\r\n      } else {\r\n        left = str.substring(0, p);\r\n      }\r\n      const right = str.substring(p + 1);\r\n      return left + spaceReplacer + stringDivider(right, width, spaceReplacer);\r\n    }\r\n  }\r\n  return str;\r\n}\r\n"],"sourceRoot":""}