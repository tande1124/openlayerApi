{"version":3,"sources":["webpack:///./kml-earthquakes.js"],"names":["styleCache","vector","source","url","format","extractStyles","style","feature","const","name","get","radius","parseFloat","substr","image","fill","color","stroke","width","raster","layer","map","layers","target","view","center","zoom","info","$","tooltip","animation","trigger","displayFeatureInfo","pixel","css","left","top","forEachFeatureAtPixel","attr","on","evt","dragging","getEventPixel","originalEvent"],"mappings":"2FAAA,gGAQMA,EAAa,GA2BbC,EAAS,IAAI,IAAY,CAC7BC,OAAQ,IAAI,IAAa,CACvBC,IAAK,qCACLC,OAAQ,IAAI,IAAI,CACdC,eAAe,MAGnBC,MAjCoB,SAAUC,GAI9BC,IAAMC,EAAOF,EAAQG,IAAI,QAEnBC,EAAS,EAAI,IADDC,WAAWH,EAAKI,OAAO,IACJ,GACjCP,EAAQN,EAAWW,GAgBvB,OAfKL,IACHA,EAAQ,IAAI,IAAM,CAChBQ,MAAO,IAAI,IAAY,CACrBH,OAAQA,EACRI,KAAM,IAAI,IAAK,CACbC,MAAO,2BAETC,OAAQ,IAAI,IAAO,CACjBD,MAAO,yBACPE,MAAO,QAIblB,EAAWW,GAAUL,GAEhBA,KAaHa,EAAS,IAAI,IAAU,CAC3BjB,OAAQ,IAAI,IAAO,CACjBkB,MAAO,YAILC,EAAM,IAAI,IAAI,CAClBC,OAAQ,CAACH,EAAQlB,GACjBsB,OAAQ,MACRC,KAAM,IAAI,IAAK,CACbC,OAAQ,CAAC,EAAG,GACZC,KAAM,MAIJC,EAAOC,EAAE,SACfD,EAAKE,QAAQ,CACXC,WAAW,EACXC,QAAS,WAGXvB,IAAMwB,EAAqB,SAAUC,GACnCN,EAAKO,IAAI,CACPC,KAAMF,EAAM,GAAK,KACjBG,IAAKH,EAAM,GAAK,GAAK,OAEvBzB,IAAMD,EAAUc,EAAIgB,sBAAsBJ,GAAO,SAAU1B,GACzD,OAAOA,KAELA,EACFoB,EAAKW,KAAK,sBAAuB/B,EAAQG,IAAI,SAASmB,QAAQ,QAE9DF,EAAKE,QAAQ,SAIjBR,EAAIkB,GAAG,eAAe,SAAUC,GAC1BA,EAAIC,SACNd,EAAKE,QAAQ,QAGfG,EAAmBX,EAAIqB,cAAcF,EAAIG,mBAG3CtB,EAAIkB,GAAG,SAAS,SAAUC,GACxBR,EAAmBQ,EAAIP,Y","file":"kml-earthquakes.js","sourcesContent":["import KML from '../src/ol/format/KML.js';\r\nimport Map from '../src/ol/Map.js';\r\nimport Stamen from '../src/ol/source/Stamen.js';\r\nimport VectorSource from '../src/ol/source/Vector.js';\r\nimport View from '../src/ol/View.js';\r\nimport {Circle as CircleStyle, Fill, Stroke, Style} from '../src/ol/style.js';\r\nimport {Tile as TileLayer, Vector as VectorLayer} from '../src/ol/layer.js';\r\n\r\nconst styleCache = {};\r\nconst styleFunction = function (feature) {\r\n  // 2012_Earthquakes_Mag5.kml stores the magnitude of each earthquake in a\r\n  // standards-violating <magnitude> tag in each Placemark.  We extract it from\r\n  // the Placemark's name instead.\r\n  const name = feature.get('name');\r\n  const magnitude = parseFloat(name.substr(2));\r\n  const radius = 5 + 20 * (magnitude - 5);\r\n  let style = styleCache[radius];\r\n  if (!style) {\r\n    style = new Style({\r\n      image: new CircleStyle({\r\n        radius: radius,\r\n        fill: new Fill({\r\n          color: 'rgba(255, 153, 0, 0.4)',\r\n        }),\r\n        stroke: new Stroke({\r\n          color: 'rgba(255, 204, 0, 0.2)',\r\n          width: 1,\r\n        }),\r\n      }),\r\n    });\r\n    styleCache[radius] = style;\r\n  }\r\n  return style;\r\n};\r\n\r\nconst vector = new VectorLayer({\r\n  source: new VectorSource({\r\n    url: 'data/kml/2012_Earthquakes_Mag5.kml',\r\n    format: new KML({\r\n      extractStyles: false,\r\n    }),\r\n  }),\r\n  style: styleFunction,\r\n});\r\n\r\nconst raster = new TileLayer({\r\n  source: new Stamen({\r\n    layer: 'toner',\r\n  }),\r\n});\r\n\r\nconst map = new Map({\r\n  layers: [raster, vector],\r\n  target: 'map',\r\n  view: new View({\r\n    center: [0, 0],\r\n    zoom: 2,\r\n  }),\r\n});\r\n\r\nconst info = $('#info');\r\ninfo.tooltip({\r\n  animation: false,\r\n  trigger: 'manual',\r\n});\r\n\r\nconst displayFeatureInfo = function (pixel) {\r\n  info.css({\r\n    left: pixel[0] + 'px',\r\n    top: pixel[1] - 15 + 'px',\r\n  });\r\n  const feature = map.forEachFeatureAtPixel(pixel, function (feature) {\r\n    return feature;\r\n  });\r\n  if (feature) {\r\n    info.attr('data-original-title', feature.get('name')).tooltip('show');\r\n  } else {\r\n    info.tooltip('hide');\r\n  }\r\n};\r\n\r\nmap.on('pointermove', function (evt) {\r\n  if (evt.dragging) {\r\n    info.tooltip('hide');\r\n    return;\r\n  }\r\n  displayFeatureInfo(map.getEventPixel(evt.originalEvent));\r\n});\r\n\r\nmap.on('click', function (evt) {\r\n  displayFeatureInfo(evt.pixel);\r\n});\r\n"],"sourceRoot":""}