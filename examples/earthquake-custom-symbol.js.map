{"version":3,"sources":["webpack:///./earthquake-custom-symbol.js"],"names":["scale","symbol","scaleFunction","coordinate","styleCache","vector","source","url","format","extractStyles","style","feature","const","name","get","magnitude","parseFloat","substr","size","parseInt","let","canvas","document","createElement","vectorContext","getContext","pixelRatio","setStyle","fill","color","stroke","width","drawGeometry","map","image","img","imgSize","rotation","raster","layer","layers","target","view","center","zoom"],"mappings":"2FAAA,WAmBIA,EAnBJ,qGAUMC,EAAS,CACb,CAAC,EAAG,GACJ,CAAC,EAAG,GACJ,CAAC,EAAG,GACJ,CAAC,GAAI,GACL,CAAC,EAAG,GACJ,CAAC,EAAG,GACJ,CAAC,EAAG,IAGAC,EAAgB,SAAUC,GAC9B,MAAO,CAACA,EAAW,GAAKH,EAAOG,EAAW,GAAKH,IAG3CI,EAAa,GAmCbC,EAAS,IAAI,IAAY,CAC7BC,OAAQ,IAAI,IAAa,CACvBC,IAAK,qCACLC,OAAQ,IAAI,IAAI,CACdC,eAAe,MAGnBC,MAzCoB,SAAUC,GAI9BC,IAAMC,EAAOF,EAAQG,IAAI,QACnBC,EAAYC,WAAWH,EAAKI,OAAO,IACnCC,EAAOC,SAAS,GAAK,IAAMJ,EAAY,GAAI,IACjDf,EAAQkB,EAAO,GACfE,IAAIV,EAAQN,EAAWc,GACvB,IAAKR,EAAO,CACVE,IAAMS,EAASC,SAASC,cAAc,UAChCC,EAAgB,YAAUH,EAAOI,WAAW,MAAO,CACvDP,KAAM,CAACA,EAAMA,GACbQ,WAAY,IAEdF,EAAcG,SACZ,IAAI,IAAM,CACRC,KAAM,IAAI,IAAK,CAACC,MAAO,2BACvBC,OAAQ,IAAI,IAAO,CAACD,MAAO,yBAA0BE,MAAO,OAGhEP,EAAcQ,aAAa,IAAI,IAAQ,CAAC/B,EAAOgC,IAAI/B,MACnDQ,EAAQ,IAAI,IAAM,CAChBwB,MAAO,IAAI,IAAK,CACdC,IAAKd,EACLe,QAAS,CAAClB,EAAMA,GAChBmB,SAAU,QAGdjC,EAAWc,GAAQR,EAErB,OAAOA,KAaH4B,EAAS,IAAI,IAAU,CAC3BhC,OAAQ,IAAI,IAAO,CACjBiC,MAAO,YAIC,IAAI,IAAI,CAClBC,OAAQ,CAACF,EAAQjC,GACjBoC,OAAQ,MACRC,KAAM,IAAI,IAAK,CACbC,OAAQ,CAAC,EAAG,GACZC,KAAM,Q","file":"earthquake-custom-symbol.js","sourcesContent":["import KML from '../src/ol/format/KML.js';\r\nimport Map from '../src/ol/Map.js';\r\nimport Polygon from '../src/ol/geom/Polygon.js';\r\nimport Stamen from '../src/ol/source/Stamen.js';\r\nimport VectorSource from '../src/ol/source/Vector.js';\r\nimport View from '../src/ol/View.js';\r\nimport {Fill, Icon, Stroke, Style} from '../src/ol/style.js';\r\nimport {Tile as TileLayer, Vector as VectorLayer} from '../src/ol/layer.js';\r\nimport {toContext} from '../src/ol/render.js';\r\n\r\nconst symbol = [\r\n  [0, 0],\r\n  [4, 2],\r\n  [6, 0],\r\n  [10, 5],\r\n  [6, 3],\r\n  [4, 5],\r\n  [0, 0],\r\n];\r\nlet scale;\r\nconst scaleFunction = function (coordinate) {\r\n  return [coordinate[0] * scale, coordinate[1] * scale];\r\n};\r\n\r\nconst styleCache = {};\r\nconst styleFunction = function (feature) {\r\n  // 2012_Earthquakes_Mag5.kml stores the magnitude of each earthquake in a\r\n  // standards-violating <magnitude> tag in each Placemark.  We extract it from\r\n  // the Placemark's name instead.\r\n  const name = feature.get('name');\r\n  const magnitude = parseFloat(name.substr(2));\r\n  const size = parseInt(10 + 40 * (magnitude - 5), 10);\r\n  scale = size / 10;\r\n  let style = styleCache[size];\r\n  if (!style) {\r\n    const canvas = document.createElement('canvas');\r\n    const vectorContext = toContext(canvas.getContext('2d'), {\r\n      size: [size, size],\r\n      pixelRatio: 1,\r\n    });\r\n    vectorContext.setStyle(\r\n      new Style({\r\n        fill: new Fill({color: 'rgba(255, 153, 0, 0.4)'}),\r\n        stroke: new Stroke({color: 'rgba(255, 204, 0, 0.2)', width: 2}),\r\n      })\r\n    );\r\n    vectorContext.drawGeometry(new Polygon([symbol.map(scaleFunction)]));\r\n    style = new Style({\r\n      image: new Icon({\r\n        img: canvas,\r\n        imgSize: [size, size],\r\n        rotation: 1.2,\r\n      }),\r\n    });\r\n    styleCache[size] = style;\r\n  }\r\n  return style;\r\n};\r\n\r\nconst vector = new VectorLayer({\r\n  source: new VectorSource({\r\n    url: 'data/kml/2012_Earthquakes_Mag5.kml',\r\n    format: new KML({\r\n      extractStyles: false,\r\n    }),\r\n  }),\r\n  style: styleFunction,\r\n});\r\n\r\nconst raster = new TileLayer({\r\n  source: new Stamen({\r\n    layer: 'toner',\r\n  }),\r\n});\r\n\r\nconst map = new Map({\r\n  layers: [raster, vector],\r\n  target: 'map',\r\n  view: new View({\r\n    center: [0, 0],\r\n    zoom: 2,\r\n  }),\r\n});\r\n"],"sourceRoot":""}