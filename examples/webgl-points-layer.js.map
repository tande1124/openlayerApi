{"version":3,"sources":["webpack:///./webgl-points-layer.js"],"names":["literalStyle","pointsLayer","vectorSource","url","format","predefinedStyles","symbol","symbolType","src","size","color","rotateWithView","offset","opacity","rotation","map","layers","source","target","document","getElementById","view","center","zoom","refreshLayer","newStyle","const","previousLayer","style","disableHitDetection","addLayer","removeLayer","dispose","spanValid","spanInvalid","setStyleStatus","errorMsg","isError","display","firstElementChild","innerText","editor","addEventListener","textStyle","value","newLiteralStyle","JSON","parse","stringify","e","message","select","onSelectChange","animate","render","window","requestAnimationFrame"],"mappings":"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","file":"webgl-points-layer.js","sourcesContent":["import GeoJSON from '../src/ol/format/GeoJSON.js';\r\nimport Map from '../src/ol/Map.js';\r\nimport OSM from '../src/ol/source/OSM.js';\r\nimport TileLayer from '../src/ol/layer/Tile.js';\r\nimport Vector from '../src/ol/source/Vector.js';\r\nimport View from '../src/ol/View.js';\r\nimport WebGLPointsLayer from '../src/ol/layer/WebGLPoints.js';\r\n\r\nconst vectorSource = new Vector({\r\n  url: 'data/geojson/world-cities.geojson',\r\n  format: new GeoJSON(),\r\n});\r\n\r\nconst predefinedStyles = {\r\n  'icons': {\r\n    symbol: {\r\n      symbolType: 'image',\r\n      src: 'data/icon.png',\r\n      size: [18, 28],\r\n      color: 'lightyellow',\r\n      rotateWithView: false,\r\n      offset: [0, 9],\r\n    },\r\n  },\r\n  'triangles': {\r\n    symbol: {\r\n      symbolType: 'triangle',\r\n      size: 18,\r\n      color: [\r\n        'interpolate',\r\n        ['linear'],\r\n        ['get', 'population'],\r\n        20000,\r\n        '#5aca5b',\r\n        300000,\r\n        '#ff6a19',\r\n      ],\r\n      rotateWithView: true,\r\n    },\r\n  },\r\n  'triangles-latitude': {\r\n    symbol: {\r\n      symbolType: 'triangle',\r\n      size: [\r\n        'interpolate',\r\n        ['linear'],\r\n        ['get', 'population'],\r\n        40000,\r\n        12,\r\n        2000000,\r\n        24,\r\n      ],\r\n      color: [\r\n        'interpolate',\r\n        ['linear'],\r\n        ['get', 'latitude'],\r\n        -60,\r\n        '#ff14c3',\r\n        -20,\r\n        '#ff621d',\r\n        20,\r\n        '#ffed02',\r\n        60,\r\n        '#00ff67',\r\n      ],\r\n      offset: [0, 0],\r\n      opacity: 0.95,\r\n    },\r\n  },\r\n  'circles': {\r\n    symbol: {\r\n      symbolType: 'circle',\r\n      size: [\r\n        'interpolate',\r\n        ['linear'],\r\n        ['get', 'population'],\r\n        40000,\r\n        8,\r\n        2000000,\r\n        28,\r\n      ],\r\n      color: '#006688',\r\n      rotateWithView: false,\r\n      offset: [0, 0],\r\n      opacity: [\r\n        'interpolate',\r\n        ['linear'],\r\n        ['get', 'population'],\r\n        40000,\r\n        0.6,\r\n        2000000,\r\n        0.92,\r\n      ],\r\n    },\r\n  },\r\n  'circles-zoom': {\r\n    symbol: {\r\n      symbolType: 'circle',\r\n      size: ['interpolate', ['exponential', 2.5], ['zoom'], 2, 1, 14, 32],\r\n      color: '#240572',\r\n      offset: [0, 0],\r\n      opacity: 0.95,\r\n    },\r\n  },\r\n  'rotating-bars': {\r\n    symbol: {\r\n      symbolType: 'square',\r\n      rotation: ['*', ['time'], 0.1],\r\n      size: [\r\n        'array',\r\n        4,\r\n        [\r\n          'interpolate',\r\n          ['linear'],\r\n          ['get', 'population'],\r\n          20000,\r\n          4,\r\n          300000,\r\n          28,\r\n        ],\r\n      ],\r\n      color: [\r\n        'interpolate',\r\n        ['linear'],\r\n        ['get', 'population'],\r\n        20000,\r\n        '#ffdc00',\r\n        300000,\r\n        '#ff5b19',\r\n      ],\r\n      offset: [\r\n        'array',\r\n        0,\r\n        [\r\n          'interpolate',\r\n          ['linear'],\r\n          ['get', 'population'],\r\n          20000,\r\n          2,\r\n          300000,\r\n          14,\r\n        ],\r\n      ],\r\n    },\r\n  },\r\n};\r\n\r\nconst map = new Map({\r\n  layers: [\r\n    new TileLayer({\r\n      source: new OSM(),\r\n    }),\r\n  ],\r\n  target: document.getElementById('map'),\r\n  view: new View({\r\n    center: [0, 0],\r\n    zoom: 2,\r\n  }),\r\n});\r\n\r\nlet literalStyle;\r\nlet pointsLayer;\r\nfunction refreshLayer(newStyle) {\r\n  const previousLayer = pointsLayer;\r\n  pointsLayer = new WebGLPointsLayer({\r\n    source: vectorSource,\r\n    style: newStyle,\r\n    disableHitDetection: true,\r\n  });\r\n  map.addLayer(pointsLayer);\r\n\r\n  if (previousLayer) {\r\n    map.removeLayer(previousLayer);\r\n    previousLayer.dispose();\r\n  }\r\n  literalStyle = newStyle;\r\n}\r\n\r\nconst spanValid = document.getElementById('style-valid');\r\nconst spanInvalid = document.getElementById('style-invalid');\r\nfunction setStyleStatus(errorMsg) {\r\n  const isError = typeof errorMsg === 'string';\r\n  spanValid.style.display = errorMsg === null ? 'initial' : 'none';\r\n  spanInvalid.firstElementChild.innerText = isError ? errorMsg : '';\r\n  spanInvalid.style.display = isError ? 'initial' : 'none';\r\n}\r\n\r\nconst editor = document.getElementById('style-editor');\r\neditor.addEventListener('input', function () {\r\n  const textStyle = editor.value;\r\n  try {\r\n    const newLiteralStyle = JSON.parse(textStyle);\r\n    if (JSON.stringify(newLiteralStyle) !== JSON.stringify(literalStyle)) {\r\n      refreshLayer(newLiteralStyle);\r\n    }\r\n    setStyleStatus(null);\r\n  } catch (e) {\r\n    setStyleStatus(e.message);\r\n  }\r\n});\r\n\r\nconst select = document.getElementById('style-select');\r\nselect.value = 'circles';\r\nfunction onSelectChange() {\r\n  const style = select.value;\r\n  const newLiteralStyle = predefinedStyles[style];\r\n  editor.value = JSON.stringify(newLiteralStyle, null, 2);\r\n  try {\r\n    refreshLayer(newLiteralStyle);\r\n    setStyleStatus();\r\n  } catch (e) {\r\n    setStyleStatus(e.message);\r\n  }\r\n}\r\nonSelectChange();\r\nselect.addEventListener('change', onSelectChange);\r\n\r\n// animate the map\r\nfunction animate() {\r\n  map.render();\r\n  window.requestAnimationFrame(animate);\r\n}\r\nanimate();\r\n"],"sourceRoot":""}